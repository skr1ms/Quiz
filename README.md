# FastAPI Quiz Application

Веб-приложение для получения и хранения вопросов викторины из внешних API с полным циклом CI/CD.

## Описание приложения

Приложение представляет собой полнофункциональный веб-сервис, который:

- **Получает вопросы викторины** из внешнего API (API Ninjas) по запросу пользователя
- **Сохраняет полученные данные** в базу данных PostgreSQL для последующего просмотра
- **Предоставляет REST API** для работы с данными (получение, создание, просмотр истории)
- **Имеет веб-интерфейс** для удобного взаимодействия с сервисом
- **Мониторинг и логирование** через Prometheus и Grafana

### Основной функционал

1. **Получение вопросов викторины:**
   - По конкретному числу (например, вопрос о числе 42)
   - Случайный вопрос викторины
   - Автоматическое сохранение в базу данных

2. **Просмотр истории:**
   - Список всех сохраненных вопросов с пагинацией
   - Просмотр конкретного вопроса по ID
   - Фильтрация и поиск

3. **API документация:**
   - Автоматически генерируемая документация через SwaggerUI/OpenAPI
   - Доступна по адресу `/docs`

## Что было реализовано

### ✅ Backend (FastAPI)

- **Clean Architecture** - разделение на слои (Domain, Application, Infrastructure, Presentation)
- **REST API** с полной документацией через OpenAPI/SwaggerUI
- **Интеграция с внешним API** (API Ninjas) для получения вопросов викторины
- **База данных PostgreSQL** с использованием SQLAlchemy (async)
- **Миграции базы данных** через Alembic
- **Метрики Prometheus** для мониторинга
- **Тестирование** - полное покрытие тестами всех слоев приложения
- **Валидация данных** через Pydantic

### ✅ Frontend (TypeScript + Vite)

- **SPA приложение** с клиентской маршрутизацией
- **Интерфейс для работы с API:**
  - Получение вопросов викторины
  - Просмотр истории сохраненных данных
  - Проверка статуса сервиса
- **Развертывание через Nginx**

### ✅ Инфраструктура

- **Docker контейнеризация** всех компонентов
- **Docker Compose** для оркестрации сервисов
- **Система мониторинга:**
  - Prometheus для сбора метрик
  - Grafana для визуализации
  - Loki для сбора логов
  - Promtail для отправки логов в Loki
- **Health checks** для всех сервисов

### ✅ CI/CD (GitLab)

- **Автоматическая сборка** Docker образов для backend и frontend
- **Автоматическое тестирование** при каждом коммите
- **Автоматический деплой** на сервер при успешной сборке
- **Разделение сборки и деплоя** на разные машины
- **Container Registry** для хранения образов
- **Очистка неиспользуемых образов**

### ✅ Документация

- Полная документация API (API-SPEC.md)
- Описание архитектуры (ARCHITECTURE.md)
- Инструкции по развертыванию (DEPLOYMENT.md)
- Настройка CI/CD (CI-CD.md)
- Настройка базы данных (DATABASE.md)
- Настройка мониторинга (MONITORING.md)

## Структура проекта

```
.
├── backend/              # Backend приложение (FastAPI)
│   ├── src/app/         # Исходный код приложения
│   │   ├── domain/      # Доменный слой
│   │   ├── application/ # Слой приложения (use cases)
│   │   ├── infrastructure/ # Слой инфраструктуры
│   │   └── presentation/   # Слой представления (HTTP)
│   ├── tests/          # Тесты
│   └── config/         # Dockerfile и конфигурация
│
├── frontend/            # Frontend приложение (TypeScript)
│   ├── src/            # Исходный код
│   └── config/        # Dockerfile и конфигурация Nginx
│
├── deployment/         # Конфигурация развертывания
│   └── docker/        # Docker Compose файлы
│
├── monitoring/         # Конфигурация мониторинга
│   ├── prometheus/    # Конфигурация Prometheus
│   ├── grafana/       # Дашборды Grafana
│   ├── loki/          # Конфигурация Loki
│   └── promtail/      # Конфигурация Promtail
│
├── docs/              # Документация проекта
│
├── .gitlab-ci.yml     # Конфигурация CI/CD (сборка и тесты)
└── .gitlab-deploy.yml # Конфигурация деплоя
```

## Быстрый старт

### Предварительные требования

- Docker версии 20.10 или выше
- Docker Compose версии 2.0 или выше
- Git

### Локальный запуск

1. **Клонируйте репозиторий:**
```bash
git clone <repository-url>
cd pz1
```

2. **Создайте файл `.env` в корне проекта:**
```bash
# Database
DB_USER=postgres
DB_PASSWORD=your_secure_password
DB_NAME=fastapi_db
DB_PORT=5432

# Backend
BACKEND_PORT=8081
ENVIRONMENT=local
DEBUG=true

# Frontend
FRONTEND_PORT=8000
VITE_API_BASE_URL=http://localhost:8081

# External API
API_NINJAS=your_api_ninjas_key
API_NINJAS_BASE_URL=https://api.api-ninjas.com/v1
```

3. **Запустите приложение:**
```bash
cd deployment/docker
docker compose --env-file ../../.env -f docker-compose.yml up -d
```

4. **Откройте в браузере:**
- Frontend: http://localhost:8000
- Backend API: http://localhost:8081
- API документация: http://localhost:8081/docs
- Grafana: http://localhost:3000 (admin/admin)

### Получение API ключа API Ninjas

1. Зарегистрируйтесь на [API Ninjas](https://api-ninjas.com/)
2. Получите бесплатный API ключ
3. Добавьте его в файл `.env` как `API_NINJAS`

## Документация

Подробная документация доступна в директории `docs/`:

- [API Спецификация](docs/API-SPEC.md) - описание всех endpoints API
- [Архитектура](docs/ARCHITECTURE.md) - описание архитектуры приложения
- [Развертывание](docs/DEPLOYMENT.md) - инструкции по развертыванию
- [CI/CD](docs/CI-CD.md) - настройка и использование CI/CD
- [База данных](docs/DATABASE.md) - работа с базой данных
- [Мониторинг](docs/MONITORING.md) - настройка мониторинга

## Технологический стек

### Backend
- **FastAPI** - современный веб-фреймворк для Python
- **SQLAlchemy** - ORM для работы с базой данных
- **PostgreSQL** - реляционная база данных
- **Pydantic** - валидация данных
- **Alembic** - миграции базы данных
- **Prometheus** - сбор метрик

### Frontend
- **TypeScript** - типизированный JavaScript
- **Vite** - сборщик и dev-сервер
- **Nginx** - веб-сервер

### Инфраструктура
- **Docker** - контейнеризация
- **Docker Compose** - оркестрация контейнеров
- **GitLab CI/CD** - автоматизация сборки и деплоя
- **Prometheus** - мониторинг метрик
- **Grafana** - визуализация метрик
- **Loki** - сбор логов

## Развертывание через CI/CD

Проект настроен для автоматического развертывания через GitLab CI/CD. Подробные инструкции по настройке локального GitLab и CI/CD доступны в [документации CI/CD](docs/CI-CD.md).

### Основные этапы CI/CD:

1. **Build** - сборка Docker образов для backend и frontend
2. **Test** - запуск автоматических тестов
3. **Deploy** - автоматическое развертывание на сервер
4. **Cleanup** - очистка неиспользуемых образов

## Требования к системе

### Минимальные требования:
- 4 ГБ оперативной памяти
- 10 ГБ свободного места на диске
- Docker и Docker Compose

### Для развертывания через CI/CD:
- Сервер с GitLab (или доступ к GitLab.com)
- Сервер для развертывания приложения
- Настроенный GitLab Runner

## Лицензия

Этот проект создан в учебных целях.

## Автор

Проект выполнен в рамках учебного задания по разработке веб-сервисов с использованием CI/CD.
