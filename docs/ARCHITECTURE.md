# Архитектура проекта

Проект построен на основе принципов Clean Architecture, что обеспечивает разделение ответственности, независимость от фреймворков и простоту тестирования.

## Общая структура

Проект состоит из двух основных компонентов:
- Backend - FastAPI приложение, предоставляющее REST API
- Frontend - TypeScript SPA приложение, работающее через Nginx

## Архитектура бэкенда

Бэкенд следует принципам Clean Architecture, разделяясь на несколько слоев:

### Слои приложения

#### Domain (Доменный слой)
Содержит бизнес-логику и сущности, независимые от внешних зависимостей:
- `entities/` - доменные сущности (ApiData)
- `value_objects/` - объекты-значения
- `services/` - доменные сервисы

Доменные сущности представляют основные бизнес-концепции приложения. Они не зависят от баз данных, веб-фреймворков или внешних библиотек.

#### Application (Слой приложения)
Содержит use cases (варианты использования) приложения:
- `commands/` - команды для изменения состояния (FetchApiDataCommand)
- `queries/` - запросы для чтения данных (GetApiDataQuery)
- `common/` - общие сервисы приложения

Слой приложения инкапсулирует бизнес-логику приложения и определяет, что должно быть выполнено, но не как это реализовано.

#### Infrastructure (Слой инфраструктуры)
Содержит реализацию внешних зависимостей:
- `persistence/` - работа с базой данных (репозитории, модели SQLAlchemy)
- `adapters/` - адаптеры для внешних сервисов (PublicApiClient для API Ninjas)
- `auth/` - аутентификация и авторизация

Этот слой реализует интерфейсы, определенные в слоях выше, и взаимодействует с внешним миром.

#### Presentation (Слой представления)
Содержит HTTP интерфейс приложения:
- `controllers/` - HTTP контроллеры (api_data_controller)
- `schemas/` - Pydantic схемы для валидации запросов и ответов
- `errors/` - обработка ошибок

Слой представления обрабатывает HTTP запросы, преобразует их в команды/запросы и возвращает результаты клиенту.

### Принципы архитектуры

Проект следует принципам, описанным в репозитории [fastapi-clean-example](https://github.com/ivan-borovets/fastapi-clean-example):

1. **Dependency Inversion Principle (DIP)** - зависимости направлены внутрь, к домену
2. **Separation of Concerns** - каждый слой имеет четко определенную ответственность
3. **CQRS (Command Query Responsibility Segregation)** - разделение операций чтения и записи
4. **Repository Pattern** - абстракция доступа к данным
5. **Unit of Work** - управление транзакциями базы данных

### Поток данных

1. HTTP запрос приходит в контроллер (Presentation)
2. Контроллер создает команду или запрос (Application)
3. Команда/запрос использует репозиторий для доступа к данным (Infrastructure)
4. Репозиторий работает с доменными сущностями (Domain)
5. Результат возвращается обратно через слои в виде HTTP ответа

## Архитектура фронтенда

Фронтенд представляет собой одностраничное приложение (SPA), построенное на TypeScript и Vite.

### Структура компонентов

#### Страницы (`src/pages/`)
- `home.ts` - главная страница с проверкой статуса сервиса
- `fetch-data.ts` - страница получения вопросов викторины
- `data-list.ts` - страница со списком сохраненных данных

#### Компоненты (`src/components/`)
- `router.ts` - маршрутизация на клиентской стороне
- `header.ts` - шапка приложения
- `nav.ts` - навигационное меню

#### Сервисы (`src/services/`)
- `api-client.ts` - клиент для взаимодействия с бэкенд API

#### Утилиты (`src/utils/`)
- `format.ts` - функции форматирования данных (даты, ошибки)

### Архитектурные решения

1. **Роутинг на клиенте** - навигация без перезагрузки страницы
2. **Модульная структура** - каждый компонент в отдельном файле
3. **Типизация TypeScript** - строгая типизация для надежности кода
4. **API клиент** - централизованное управление HTTP запросами

### Развертывание

Фронтенд собирается через Vite в статические файлы и раздается через Nginx. Nginx также проксирует API запросы к бэкенду, что позволяет обойти проблемы CORS.

### Интеграция с бэкендом

Фронтенд взаимодействует с бэкендом через REST API:
- Базовый URL настраивается через переменную окружения `VITE_API_BASE_URL`
- Все запросы проходят через API клиент с обработкой ошибок
- Данные валидируются через TypeScript типы

## Связь между компонентами

Backend и Frontend взаимодействуют через REST API:

1. Frontend отправляет HTTP запросы к Backend
2. Backend обрабатывает запросы через контроллеры
3. Backend возвращает JSON ответы
4. Frontend отображает данные пользователю

Оба компонента развертываются в отдельных Docker контейнерах и общаются через внутреннюю сеть Docker.

## Зависимости

### Backend
- FastAPI - веб-фреймворк
- SQLAlchemy - ORM для работы с базой данных
- Pydantic - валидация данных
- Alembic - миграции базы данных
- httpx - HTTP клиент для внешних API

### Frontend
- TypeScript - типизированный JavaScript
- Vite - сборщик и dev-сервер
- Nginx - веб-сервер для раздачи статики

## Дополнительные ресурсы

Для более глубокого понимания архитектуры бэкенда рекомендуется изучить исходный проект: https://github.com/ivan-borovets/fastapi-clean-example

В этом репозитории подробно описаны паттерны и принципы, используемые в проекте, включая Dependency Injection, Unit of Work, CQRS и другие важные концепции.

